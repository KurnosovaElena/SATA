import React, { useState } from 'react';
import "./studentprofile.css";
import Sidebar from "../components/sidebar/Sidebar";
import { Link } from 'react-router-dom';
import Popup from './lab-pop-up/Popup';

function StudentProfilePage() {
  const [isSidebarOpen, setSidebarOpen] = useState(false);
  const [showLabPopup, setShowLabPopup] = useState(false);
  const [subjects, setSubjects] = useState([]);

  const handleEditProfile = () => {
    // Handle edit profile logic here
  };

  const handleLabWork = () => {
    // Toggle the visibility of the lab work pop-up
    setShowLabPopup(!showLabPopup);
  };

  const handleLogout = () => {
    // Handle logout logic here
  };

  const toggleSidebar = () => {
    setSidebarOpen(!isSidebarOpen);
  };

  const closeSidebar = () => {
    setSidebarOpen(false);
  };

  const getTextColor = (widthPercentage, forCount = false) => {
    const threshold = forCount ? 90 : 15;
    return widthPercentage > threshold ? 'white' : '#676B57';
  };

  const calculateWidth = (completed, total) => {
    return (completed / total) * 100;
  };

  return (
    <div className="profile-page">
      <Sidebar isOpen={isSidebarOpen} onClose={closeSidebar} />
      {isSidebarOpen && <div className="overlay active" onClick={toggleSidebar}></div>}
      <div className="profile-header">
        <div className="header-left">
          <div className="menu-icon" onClick={toggleSidebar}>
            <svg width="41" height="27" viewBox="0 0 41 27" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 13.6567H38.3008H3ZM3 24.3134H38.3008H3ZM3 3H38.3008H3Z" fill="#ABABAB" />
              <path d="M3 13.6567H38.3008M3 24.3134H38.3008M3 3H38.3008" stroke="#ABABAB" strokeWidth="5" strokeLinecap="round" />
            </svg>
          </div>
          <div className="notification-icon">
            <svg width="30" height="37" viewBox="0 0 30 37" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M26.0192 15.4828V15.4825C26.0157 12.4377 25.0051 9.4986 23.1772 7.23397C21.3984 5.03026 18.9665 3.61582 16.3269 3.25452V1V0.75H16.0769H13.9231H13.6731V1V3.25452C11.0335 3.61582 8.6016 5.03026 6.82281 7.23397C4.99486 9.4986 3.98429 12.4377 3.98077 15.4825V15.4828V19.7153L1.1289 22.9113C0.883691 23.1861 0.750038 23.5533 0.75 23.931V27.5518C0.75 27.9295 0.883651 28.2968 1.12889 28.5716C1.37496 28.8474 1.71521 29.0087 2.07692 29.0087H9.36539V29.6943C9.34165 31.2784 9.83984 32.8204 10.77 34.0247C11.701 35.2301 13.0017 36.0145 14.4262 36.218L14.4262 36.2181L14.4339 36.2189C15.2216 36.3065 16.0166 36.2083 16.7671 35.9312C17.5176 35.6541 18.2058 35.2049 18.7883 34.6144C19.3708 34.0239 19.8349 33.305 20.1523 32.5048C20.4696 31.7046 20.6337 30.8398 20.6346 29.9658V29.9656V29.0087H27.9231C28.2848 29.0087 28.625 28.8474 28.8711 28.5716C29.1164 28.2968 29.25 27.9295 29.25 27.5518V23.9311C29.25 23.5533 29.1163 23.1861 28.8711 22.9113L26.0192 19.7153V15.4828ZM6.63462 20.3104V20.3104V15.4828C6.63462 12.9798 7.52211 10.5842 9.09454 8.82198C10.6661 7.06071 12.7912 6.07759 15 6.07759C17.2089 6.07759 19.3339 7.06071 20.9055 8.82198C22.4779 10.5842 23.3654 12.9798 23.3654 15.4828V20.3104V20.3104C23.3655 20.6882 23.4992 21.0553 23.7444 21.3301L26.5962 24.5262V26.0949H3.40385V24.5262L6.25559 21.3301C6.50084 21.0553 6.63454 20.6882 6.63462 20.3104ZM17.9808 29.9656C17.9808 30.8681 17.6606 31.7288 17.098 32.3593C16.5362 32.9889 15.7808 33.3362 15 33.3362C14.2192 33.3362 13.4638 32.9889 12.902 32.3593C12.3394 31.7288 12.0192 30.8681 12.0192 29.9656V29.0087H17.9808V29.9656Z" fill="#ABABAB" stroke="#ABABAB" strokeWidth="0.5" />
            </svg>
          </div>
        </div>
        <div className="header-right">
          <Link to="/">
            <div className="profile-icon">
            <svg className="default-icon" width="157" height="52" viewBox="0 0 157 52" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2 6L2 50" stroke="#83A36B" strokeWidth="4" strokeLinecap="round"/>
              <path d="M9.632 26.308C9.296 26.308 8.94133 26.28 8.568 26.224C8.21333 26.168 7.82133 26.0933 7.392 26L7.672 22.164C7.93333 22.2387 8.204 22.276 8.484 22.276C9.24933 22.276 9.84667 21.968 10.276 21.352C10.7053 20.7173 11.0133 19.812 11.2 18.636C11.3867 17.46 11.508 16.032 11.564 14.352L11.844 6.4H26.908V26H22.428V9.06L23.464 10.096H14.812L15.736 9.004L15.568 14.184C15.512 16.1067 15.3813 17.8147 15.176 19.308C14.9707 20.8013 14.6533 22.0707 14.224 23.116C13.7947 24.1613 13.2067 24.9547 12.46 25.496C11.7133 26.0373 10.7707 26.308 9.632 26.308ZM31.8032 26V6.4H36.3112V19.168L45.6632 6.4H49.9192V26H45.4392V13.26L36.0872 26H31.8032ZM66.5164 18.692C65.5457 19.084 64.6124 19.3827 63.7164 19.588C62.8204 19.7747 61.9617 19.868 61.1404 19.868C58.5084 19.868 56.4924 19.2427 55.0924 17.992C53.6924 16.7227 52.9924 14.9027 52.9924 12.532V6.4H57.4724V12.028C57.4724 13.372 57.8364 14.3893 58.5644 15.08C59.2924 15.752 60.3284 16.088 61.6724 16.088C62.5311 16.088 63.3617 15.9947 64.1644 15.808C64.9671 15.6027 65.7137 15.3133 66.4044 14.94L66.5164 18.692ZM65.8724 26V6.4H70.3524V26H65.8724ZM88.6651 6.4H93.2011V26H88.6651V6.4ZM79.7611 26H75.2251V6.4H79.7611V26ZM89.0011 17.964H79.4251V14.128H89.0011V17.964ZM107.604 12.84C109.974 12.84 111.804 13.372 113.092 14.436C114.38 15.4813 115.024 17.0587 115.024 19.168C115.024 21.408 114.305 23.1067 112.868 24.264C111.449 25.4213 109.48 26 106.96 26H98.1118V6.4H102.62V12.84H107.604ZM106.708 22.64C107.865 22.64 108.78 22.3507 109.452 21.772C110.124 21.1933 110.46 20.3533 110.46 19.252C110.46 18.1693 110.124 17.3947 109.452 16.928C108.798 16.4427 107.884 16.2 106.708 16.2H102.62V22.64H106.708ZM117.516 26V6.4H122.024V26H117.516ZM126.905 26V6.4H131.413V19.168L140.765 6.4H145.021V26H140.541V13.26L131.189 26H126.905ZM135.949 5.14C134.082 5.14 132.71 4.76667 131.833 4.02C130.974 3.27333 130.535 2.21867 130.517 0.855998H133.625C133.643 1.528 133.839 2.04133 134.213 2.396C134.605 2.732 135.183 2.9 135.949 2.9C136.695 2.9 137.265 2.732 137.657 2.396C138.049 2.04133 138.254 1.528 138.273 0.855998H141.381C141.362 2.21867 140.914 3.27333 140.037 4.02C139.159 4.76667 137.797 5.14 135.949 5.14Z" fill="#83A36B"/>
              <path d="M22.12 49L16.016 39.564L19.684 37.352L27.272 49H22.12ZM9.38 49V29.4H13.888V49H9.38ZM12.572 41.104V37.324H19.404V41.104H12.572ZM20.104 39.704L15.932 39.2L22.288 29.4H27.076L20.104 39.704ZM27.4748 49L36.2108 29.4H40.6908L49.4548 49H44.6948L37.5268 31.696H39.3188L32.1228 49H27.4748ZM31.8428 44.8L33.0468 41.356H43.1268L44.3588 44.8H31.8428ZM52.754 49V29.4H68.574V33.012H57.262V37.044H62.694C65.0646 37.044 66.866 37.5387 68.098 38.528C69.3486 39.5173 69.974 40.9547 69.974 42.84C69.974 44.7813 69.2833 46.2933 67.902 47.376C66.5206 48.4587 64.57 49 62.05 49H52.754ZM57.262 45.64H61.798C62.9553 45.64 63.842 45.416 64.458 44.968C65.074 44.5013 65.382 43.8293 65.382 42.952C65.382 41.2347 64.1873 40.376 61.798 40.376H57.262V45.64ZM74.1258 49V29.4H78.6338V42.168L87.9858 29.4H92.2418V49H87.7618V36.26L78.4098 49H74.1258ZM111.262 29.4H115.798V49H111.262V29.4ZM102.358 49H97.8219V29.4H102.358V49ZM111.598 40.964H102.022V37.128H111.598V40.964ZM125.581 37.296H135.017V40.824H125.581V37.296ZM125.917 45.36H136.585V49H121.409V29.4H136.221V33.04H125.917V45.36ZM145.176 49V32.06L146.212 33.096H138.932V29.4H155.928V33.096H148.648L149.656 32.06V49H145.176Z" fill="#ABABAB"/>
            </svg>
            <svg className="hover-icon" component={Link} to="/" width="165" height="48" viewBox="0 0 165 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 2L2 46" stroke="#83A36B" stroke-width="4" stroke-linecap="round"/>
            <path d="M22.876 2.4H27.412V22H22.876V2.4ZM13.972 22H9.436V2.4H13.972V22ZM23.212 13.964H13.636V10.128H23.212V13.964ZM30.1107 22L38.8467 2.4H43.3267L52.0907 22H47.3307L40.1627 4.696H41.9547L34.7587 22H30.1107ZM34.4787 17.8L35.6827 14.356H45.7627L46.9947 17.8H34.4787Z" fill="#83A36B"/>
            <path d="M9.436 45V25.4H23.268L23.24 29.096H12.88L13.916 28.06L13.944 45H9.436ZM24.4961 45.308C24.1601 45.308 23.8054 45.28 23.4321 45.224C23.0774 45.168 22.6854 45.0933 22.2561 45L22.5361 41.164C22.7974 41.2387 23.0681 41.276 23.3481 41.276C24.1134 41.276 24.7107 40.968 25.1401 40.352C25.5694 39.7173 25.8774 38.812 26.0641 37.636C26.2507 36.46 26.3721 35.032 26.4281 33.352L26.7081 25.4H41.7721V45H37.2921V28.06L38.3281 29.096H29.6761L30.6001 28.004L30.4321 33.184C30.3761 35.1067 30.2454 36.8147 30.0401 38.308C29.8347 39.8013 29.5174 41.0707 29.0881 42.116C28.6587 43.1613 28.0707 43.9547 27.3241 44.496C26.5774 45.0373 25.6347 45.308 24.4961 45.308ZM45.1553 45L53.8913 25.4H58.3713L67.1353 45H62.3753L55.2073 27.696H56.9993L49.8033 45H45.1553ZM49.5233 40.8L50.7273 37.356H60.8073L62.0393 40.8H49.5233ZM70.4344 45V25.4H79.5624C81.8398 25.4 83.6131 25.8387 84.8824 26.716C86.1518 27.5933 86.7864 28.844 86.7864 30.468C86.7864 32.0733 86.1891 33.324 84.9944 34.22C83.7998 35.0973 82.2131 35.536 80.2344 35.536L80.7664 34.36C82.9691 34.36 84.6771 34.7987 85.8904 35.676C87.1038 36.5533 87.7104 37.8227 87.7104 39.484C87.7104 41.2013 87.0571 42.5547 85.7504 43.544C84.4624 44.5147 82.5771 45 80.0944 45H70.4344ZM74.9424 41.64H79.9264C80.9718 41.64 81.7651 41.4347 82.3064 41.024C82.8478 40.6133 83.1184 39.9787 83.1184 39.12C83.1184 38.2987 82.8478 37.692 82.3064 37.3C81.7651 36.8893 80.9718 36.684 79.9264 36.684H74.9424V41.64ZM74.9424 33.52H79.1704C80.1598 33.52 80.9064 33.324 81.4104 32.932C81.9144 32.5213 82.1664 31.924 82.1664 31.14C82.1664 30.356 81.9144 29.768 81.4104 29.376C80.9064 28.9653 80.1598 28.76 79.1704 28.76H74.9424V33.52ZM105.438 25.4H109.974V45H105.438V25.4ZM96.5337 45H91.9977V25.4H96.5337V45ZM105.774 36.964H96.1977V33.128H105.774V36.964ZM116.256 41.304C117.339 41.6213 118.244 41.7147 118.972 41.584C119.719 41.4347 120.382 40.912 120.96 40.016L121.912 38.588L122.332 38.112L128.828 25.4H133.28L124.936 40.912C124.19 42.312 123.303 43.3853 122.276 44.132C121.268 44.8787 120.158 45.2987 118.944 45.392C117.731 45.504 116.471 45.2893 115.164 44.748L116.256 41.304ZM122.248 41.892L113.4 25.4H118.244L124.74 38.56L122.248 41.892ZM136.136 45V25.4H140.644V33.1H145.712V37.02H140.644V45H136.136ZM153.44 45.336C151.947 45.336 150.565 45.084 149.296 44.58C148.045 44.076 146.953 43.376 146.02 42.48C145.087 41.5653 144.359 40.492 143.836 39.26C143.332 38.0093 143.08 36.656 143.08 35.2C143.08 33.7253 143.332 32.372 143.836 31.14C144.359 29.908 145.087 28.844 146.02 27.948C146.953 27.0333 148.045 26.324 149.296 25.82C150.565 25.316 151.947 25.064 153.44 25.064C154.915 25.064 156.287 25.316 157.556 25.82C158.825 26.324 159.917 27.0333 160.832 27.948C161.765 28.844 162.493 29.9173 163.016 31.168C163.539 32.4 163.8 33.744 163.8 35.2C163.8 36.656 163.539 38.0093 163.016 39.26C162.493 40.492 161.765 41.5653 160.832 42.48C159.917 43.376 158.825 44.076 157.556 44.58C156.287 45.084 154.915 45.336 153.44 45.336ZM153.44 41.472C154.261 41.472 155.017 41.3227 155.708 41.024C156.399 40.7253 157.005 40.3053 157.528 39.764C158.051 39.204 158.461 38.5413 158.76 37.776C159.059 37.0107 159.208 36.152 159.208 35.2C159.208 34.248 159.059 33.3893 158.76 32.624C158.461 31.8587 158.051 31.2053 157.528 30.664C157.005 30.104 156.399 29.6747 155.708 29.376C155.017 29.0773 154.261 28.928 153.44 28.928C152.637 28.928 151.881 29.0773 151.172 29.376C150.481 29.6747 149.875 30.104 149.352 30.664C148.829 31.2053 148.419 31.8587 148.12 32.624C147.821 33.3893 147.672 34.248 147.672 35.2C147.672 36.152 147.821 37.0107 148.12 37.776C148.419 38.5413 148.829 39.204 149.352 39.764C149.875 40.3053 150.481 40.7253 151.172 41.024C151.881 41.3227 152.637 41.472 153.44 41.472Z" fill="#83A36B"/>
            </svg>
          </div>
          </Link>
        </div>
      </div>

      <div className="profile-content">
        <div className="profile-card">
          <div className="profile-left">
            <div className="profile-image">
              <svg width="200" height="200" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="50" fill="#F2F2F2" />
                <path fillRule="evenodd" clipRule="evenodd" d="M50 29.1667C43.8723 29.1667 39.0625 33.9765 39.0625 40.1042C39.0625 46.2319 43.8723 51.0417 50 51.0417C56.1277 51.0417 60.9375 46.2319 60.9375 40.1042C60.9375 33.9765 56.1277 29.1667 50 29.1667ZM34.375 40.1042C34.375 31.6351 41.5309 24.4792 50 24.4792C58.4691 24.4792 65.625 31.6351 65.625 40.1042C65.625 48.5733 58.4691 55.7292 50 55.7292C41.5309 55.7292 34.375 48.5733 34.375 40.1042ZM29.1667 70.8333C29.1667 64.7056 33.9765 59.8958 40.1042 59.8958H59.8958C66.0235 59.8958 70.8333 64.7056 70.8333 70.8333C70.8333 71.8548 70.0208 72.6667 69 72.6667C67.9792 72.6667 67.1667 71.8548 67.1667 70.8333C67.1667 66.7109 63.6676 63.2083 59.5417 63.2083H40.4583C36.3324 63.2083 32.8333 66.7109 32.8333 70.8333C32.8333 71.8548 32.0208 72.6667 31 72.6667C29.9792 72.6667 29.1667 71.8548 29.1667 70.8333Z" fill="#83A36B" />
              </svg>
            </div>
            <div className="profile-info">
              <h1 className="profile-name">Никита Егоров</h1>
              <h2 className="profile-group">ПИР-211</h2>
              <p className="profile-faculty">Инженерно-Экономический факультет</p>
            </div>
          </div>
          <div className="profile-right">
            <button className="lab-work-button" onClick={handleLabWork}>
              <div className="lab-work-header">
                <div className="lab-work-icon"> 
                <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M23 10.1667V21.25C23 22.2165 22.2165 23 21.25 23H3.75C2.7835 23 2 22.2165 2 21.25V3.75C2 2.7835 2.7835 2 3.75 2H16" stroke="black" stroke-width="2.33333" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7.8335 10.1666L13.6668 14.8333L22.4168 2.58331" stroke="black" stroke-width="2.33333" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                </div>
                <h3 className="profile-section-title">Лабораторные работы</h3>
              </div>
               <div className="progress-bar-container">
                {subjects.slice(0, 5).map((subject, index) => {
                  const completedLabs = subject.labs.filter(lab => lab.completed).length;
                  const totalLabs = subject.labs.length;
                  const width = calculateWidth(completedLabs, totalLabs);
                  return (
                    <div className="progress-bar" key={index}>
                      <div className="progress-filled" style={{ width: `${width}%` }}></div>
                      <span className="progress-text subject" style={{ color: getTextColor(width) }}>{subject.name}</span>
                      <span className="progress-text count" style={{ color: getTextColor(width, true) }}>{`${completedLabs}/${totalLabs}`}</span>
                    </div>
                  );
                })}
                {Array.from({ length: 5 - subjects.length }).map((_, index) => (
                  <div className="progress-bar empty-slot" key={`empty-${index}`}>
                    <span className="progress-text empty-text">Добавить предмет</span>
                  </div>
                ))}
              </div>
            </button>
            <div className="profile-actions">
              <button className="profile-action-button" onClick={handleEditProfile}>
                <div className="profile-settings-icon">
                <svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.32227 24.25V15.5" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4.32227 10.5V1.75" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.2881 24.25V13" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.2881 8V1.75" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20.2544 24.25V18" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20.2544 13V1.75" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M1.33496 15.5H7.30954" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9.30078 8H15.2754" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M17.2671 18H23.2417" stroke="#32381C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                </div> Редактировать профиль
              </button>
              <button className="profile-action-button" onClick={handleLogout}>
                <div className="profile-logout-icon">
                <svg width="29" height="27" viewBox="0 0 29 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.7101 0C16.5249 0 17.3064 0.31607 17.8826 0.87868C18.4588 1.44129 18.7826 2.20435 18.7826 3V6.954C18.7826 7.35182 18.6207 7.73336 18.3326 8.01466C18.0445 8.29597 17.6537 8.454 17.2463 8.454C16.8389 8.454 16.4481 8.29597 16.16 8.01466C15.8719 7.73336 15.7101 7.35182 15.7101 6.954V3H4.95638C4.54894 3 4.1582 3.15804 3.87009 3.43934C3.58199 3.72064 3.42014 4.10218 3.42014 4.5V22.5C3.42014 22.8978 3.58199 23.2794 3.87009 23.5607C4.1582 23.842 4.54894 24 4.95638 24H14.1738C14.5813 24 14.972 23.842 15.2601 23.5607C15.5482 23.2794 15.7101 22.8978 15.7101 22.5V20.046C15.7101 19.6482 15.8719 19.2666 16.16 18.9853C16.4481 18.704 16.8389 18.546 17.2463 18.546C17.6537 18.546 18.0445 18.704 18.3326 18.9853C18.6207 19.2666 18.7826 19.6482 18.7826 20.046V24C18.7826 24.7956 18.4588 25.5587 17.8826 26.1213C17.3064 26.6839 16.5249 27 15.7101 27H3.42014C2.60527 27 1.82377 26.6839 1.24757 26.1213C0.671363 25.5587 0.347656 24.7956 0.347656 24V3C0.347656 2.20435 0.671363 1.44129 1.24757 0.87868C1.82377 0.31607 2.60527 0 3.42014 0H15.7101Z" fill="black"/>
                <path d="M11.1011 13.5H27.9997M27.9997 13.5L23.391 8.25M27.9997 13.5L23.391 18.75" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                </div> Выйти из аккаунта
              </button>
            </div>
          </div>
        </div>
      </div>

      <Popup
        isVisible={showLabPopup}
        onClose={handleLabWork}
        subjects={subjects}
        setSubjects={setSubjects}
      />
    </div>
  );
}

export default StudentProfilePage;
